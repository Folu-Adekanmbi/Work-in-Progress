#include "cmath"
#include "iostream"
#include "Arduino.h"
#include "Tank.h"
#include "Enes100.h"

//F is front, B is back, R is right, L is left, D is drive, S is speed for these pin assignments
#define FRD1 8
#define FRD2 7
#define FLD1 10
#define FLD2 11
#define BRD1 6
#define BRD2 5
#define BLD1 12
#define BLD2 13
#define S 3

// Normalize angle to [-π, π]
float normalizeAngle(float angle) {
  while (angle > PI) angle -= 2 * PI;
  while (angle < -PI) angle += 2 * PI;
  return angle;
}

// Proportional angle correction
void correctOrientation(float tf) {
  float ti = Enes100.getTheta();
  float dt = normalizeAngle(tf - ti);
  float Kp = 50.0;

  while (abs(dt) > 0.05) {
    ti = Enes100.getTheta();
    dt = normalizeAngle(tf - ti);
    int pwmSpeed = Kp * abs(dt);
    if (pwmSpeed > 255) pwmSpeed = 255;

    if (dt > 0) {
      rotateCCW();
    } else {
      rotateCW();
    }
    delay(10);
  }
  stopotv();
}

void motorCW (int m1, int m2) {
  digitalWrite(m1, HIGH);
  digitalWrite(m2, LOW);
  digitalWrite(S, HIGH);
}

void motorCCW (int m1, int m2) {
  digitalWrite(m1, LOW);
  digitalWrite(m2, HIGH);
  digitalWrite(S, HIGH);
}

void motorStop (int m1, int m2) {
  digitalWrite(m1, LOW);
  digitalWrite(m2, LOW);
  digitalWrite(S, LOW);
}

void driveForwards () {
motorCCW(FRD1,FRD2);
motorCW(FLD1,FLD2);
motorCCW(BRD1,BRD2);
motorCW(BLD1,BLD2);
}
void driveBackwards () {
motorCW(FRD1,FRD2);
motorCCW(FLD1,FLD2);
motorCW(BRD1,BRD2);
motorCCW(BLD1,BLD2);
}
void strafeLeft () {
motorCCW(FRD1,FRD2);
motorCW(BRD1,BRD2);
motorCCW(FLD1,FLD2);
motorCW(BLD1,BLD2);
// check if it makes sense plss
}

void strafeRight () {
motorCW(FRD1, FRD2);
motorCCW(BRD1, BRD2);
motorCW(FLD1, FLD2);
motorCCW(BLD1, BLD2);
}

void rotateCW () {
motorCW(FRD1, FRD2);
motorCW(FLD1, FLD2);
motorCW(BRD1, BRD2);
motorCW(BLD1, BLD2);
}

void rotateCCW () {
motorCCW(FRD1, FRD2);
motorCCW(FLD1, FLD2);
motorCCW(BRD1, BRD2);
motorCCW(BLD1, BLD2);
}

void stopotv () {
motorStop(FRD1, FRD2);
motorStop(FLD1, FLD2);
motorStop(BRD1, BRD2);
motorStop(BLD1, BLD2);
}

void setup() {
pinMode (FRD1, OUTPUT);
pinMode (FRD2, OUTPUT);
pinMode (BRD1, OUTPUT);
pinMode (BRD2, OUTPUT);
pinMode (FLD1, OUTPUT);
pinMode (FLD2, OUTPUT);
pinMode (BLD1, OUTPUT);
pinMode (BLD2, OUTPUT);
pinMode (S, OUTPUT);
}

void loop() {
  
}
  
